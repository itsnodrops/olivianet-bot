const _0x2cc171=_0xc952;(function(_0x132687,_0x141a69){const _0x5b0dea=_0xc952,_0x32ab14=_0x132687();while(!![]){try{const _0x1619b0=parseInt(_0x5b0dea(0x201))/0x1+parseInt(_0x5b0dea(0x1f8))/0x2+-parseInt(_0x5b0dea(0x202))/0x3*(-parseInt(_0x5b0dea(0x20d))/0x4)+parseInt(_0x5b0dea(0x1fa))/0x5+parseInt(_0x5b0dea(0x217))/0x6*(-parseInt(_0x5b0dea(0x212))/0x7)+parseInt(_0x5b0dea(0x20a))/0x8+parseInt(_0x5b0dea(0x21b))/0x9*(-parseInt(_0x5b0dea(0x1f6))/0xa);if(_0x1619b0===_0x141a69)break;else _0x32ab14['push'](_0x32ab14['shift']());}catch(_0x3d2987){_0x32ab14['push'](_0x32ab14['shift']());}}}(_0x2695,0x24614));function _0x2695(){const _0x2966fc=['2256dmYctn','handle','reset','dashboard','...','AI:\x20','data','Sending\x20message\x20to\x20','424456WQTzlu','intro_message','message','676PPoemX','title','warn','agentTitle','marketplace_metadata','313733xjlfaj','success','push','setCurrentAgent','info','12yCjMEb','error','timestamp',':\x20\x22','9vBrCGo','agentId','Failed\x20to\x20increment\x20message\x20count:\x20Invalid\x20response','api','model','debug','Started\x20chat\x20with\x20','gpt-4.1','Intro:\x20','agent_id','5163070GjVTED','Failed\x20to\x20generate\x20response:\x20Invalid\x20response','342622tSZPaI','addMessage','1037760grRdkm','messages','incrementMessageCount','Received\x20response\x20from\x20','substring','/api/ai/generate','Failed\x20to\x20send\x20message:\x20','195949dZrkEF'];_0x2695=function(){return _0x2966fc;};return _0x2695();}import{logger}from'../utils/logger.js';export class ChatSession{constructor(_0x35f18d,_0x4d5da7,_0x2791d2,_0x3d94c1,_0x537fe4=null){const _0x25e7f0=_0xc952;this['api']=_0x35f18d,this[_0x25e7f0(0x21c)]=_0x4d5da7,this[_0x25e7f0(0x210)]=_0x2791d2,this[_0x25e7f0(0x203)]=_0x3d94c1,this[_0x25e7f0(0x205)]=_0x537fe4,this[_0x25e7f0(0x1fb)]=[],this[_0x25e7f0(0x21f)]=_0x25e7f0(0x1f3);}[_0x2cc171(0x1f9)](_0x11f930,_0x310d4a){const _0x32da86=_0x2cc171;this[_0x32da86(0x1fb)][_0x32da86(0x214)]({'role':_0x11f930,'content':_0x310d4a});}async['sendMessage'](_0x459c86){const _0x42e019=_0x2cc171;try{this[_0x42e019(0x1f9)]('user',_0x459c86),logger['info'](_0x42e019(0x209)+this[_0x42e019(0x210)]+_0x42e019(0x21a)+_0x459c86+'\x22',this[_0x42e019(0x203)]);const _0x3ce05e={'model':this[_0x42e019(0x21f)],'messages':this[_0x42e019(0x1fb)],'agentId':this[_0x42e019(0x21c)]},_0x2e78a2=await this[_0x42e019(0x21e)]['post'](_0x42e019(0x1ff),_0x3ce05e);if(_0x2e78a2[_0x42e019(0x213)]&&_0x2e78a2[_0x42e019(0x208)]){const _0xa1b17c=_0x2e78a2[_0x42e019(0x208)]['text'];return this['addMessage']('assistant',_0xa1b17c),logger[_0x42e019(0x213)](_0x42e019(0x1fd)+this['agentTitle'],this[_0x42e019(0x203)]),logger[_0x42e019(0x1f1)](_0x42e019(0x207)+_0xa1b17c[_0x42e019(0x1fe)](0x0,0x64)+(_0xa1b17c['length']>0x64?_0x42e019(0x206):''),this[_0x42e019(0x203)]),{'success':!![],'response':_0xa1b17c,'timestamp':_0x2e78a2['data'][_0x42e019(0x219)],'sources':_0x2e78a2[_0x42e019(0x208)]['sources']};}else throw new Error(_0x42e019(0x1f7));}catch(_0x7ea882){return logger[_0x42e019(0x218)](_0x42e019(0x200)+_0x7ea882['message'],this['handle']),{'success':![],'error':_0x7ea882['message']};}}async[_0x2cc171(0x1fc)](){const _0x3e6e78=_0x2cc171;try{const _0x256979=await this[_0x3e6e78(0x21e)]['post']('/api/marketplace/agents/'+this[_0x3e6e78(0x21c)]+'/increment-messages');if(_0x256979[_0x3e6e78(0x213)]&&_0x256979[_0x3e6e78(0x208)]){const {previous_count:_0x42a5fc,new_count:_0x2d7549}=_0x256979[_0x3e6e78(0x208)];return logger['debug']('Message\x20count\x20updated:\x20'+_0x42a5fc+'\x20â†’\x20'+_0x2d7549,this[_0x3e6e78(0x203)]),{'success':!![],'previous_count':_0x42a5fc,'new_count':_0x2d7549};}else throw new Error(_0x3e6e78(0x21d));}catch(_0x2d9735){return logger[_0x3e6e78(0x20f)]('Failed\x20to\x20increment\x20message\x20count:\x20'+_0x2d9735[_0x3e6e78(0x20c)],this[_0x3e6e78(0x203)]),{'success':![],'error':_0x2d9735[_0x3e6e78(0x20c)]};}}['getMessageHistory'](){const _0x1a88e1=_0x2cc171;return this[_0x1a88e1(0x1fb)];}[_0x2cc171(0x204)](){this['messages']=[];}}function _0xc952(_0x634761,_0x466724){const _0x26957a=_0x2695();return _0xc952=function(_0xc952b5,_0x1fc625){_0xc952b5=_0xc952b5-0x1f1;let _0x84fbe2=_0x26957a[_0xc952b5];return _0x84fbe2;},_0xc952(_0x634761,_0x466724);}export async function startChatSession(_0x1aaeaf,_0x31fa8e,_0x5acf42,_0x5e65ef=null){const _0x1fa161=_0x2cc171,_0x1ee30a={'agent_id':_0x31fa8e[_0x1fa161(0x1f5)],'title':_0x31fa8e[_0x1fa161(0x211)]?.['title']||'Unknown\x20Agent','intro_message':_0x31fa8e[_0x1fa161(0x211)]?.[_0x1fa161(0x20b)]},_0x294792=new ChatSession(_0x1aaeaf,_0x1ee30a[_0x1fa161(0x1f5)],_0x1ee30a[_0x1fa161(0x20e)],_0x5acf42,_0x5e65ef);return _0x5e65ef&&_0x5e65ef[_0x1fa161(0x215)](_0x1ee30a['title']),_0x1ee30a[_0x1fa161(0x20b)]&&(_0x294792[_0x1fa161(0x1f9)]('assistant',_0x1ee30a['intro_message']),logger[_0x1fa161(0x216)](_0x1fa161(0x1f2)+_0x1ee30a['title'],_0x5acf42),logger[_0x1fa161(0x1f1)](_0x1fa161(0x1f4)+_0x1ee30a['intro_message'],_0x5acf42)),_0x294792;}